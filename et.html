<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Engineering Technology (ET) - AYEDU</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="video-modal.js"></script>
    <style>
        /* Existing CSS styles ... */
        .active {
            background-color: #3498db !important;
        }
        
        .filter-controls {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: end;
        }
        
        .filter-group {
            flex: 1;
            min-width: 150px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }
        
        .category-card {
            margin-bottom: 30px;
        }
        
        @media screen and (max-width: 768px) {
            .filter-controls {
                flex-direction: column;
            }
            
            .filter-group {
                width: 100%;
            }
        }

        /* --- PDF Modal Styles --- */
        .pdf-modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: hidden; 
            background-color: rgba(0,0,0,0.8); 
            backdrop-filter: blur(5px);
        }

        .pdf-modal-content {
            background-color: #fefefe;
            margin: 2% auto; 
            padding: 0;
            border: 1px solid #888;
            width: 95%; 
            height: 95%; 
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
            animation-name: modalopen;
            animation-duration: 0.4s;
        }

        .pdf-modal-header {
            padding: 10px 20px;
            background-color: #2c3e50;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            height: 50px;
        }

        .pdf-modal-title {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .pdf-modal-close {
            color: #bdc3c7;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            line-height: 1;
        }

        .pdf-modal-close:hover,
        .pdf-modal-close:focus {
            color: #fff;
            text-decoration: none;
            cursor: pointer;
        }

        .pdf-iframe-container {
            flex: 1;
            width: 100%;
            height: calc(100% - 50px); 
            background-color: #ecf0f1;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        @keyframes modalopen {
            from {opacity: 0; transform: translateY(-50px);}
            to {opacity: 1; transform: translateY(0);}
        }

        /* Styles for button actions */
        .file-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Custom style for the preview button */
        .btn-preview {
            background-color: #27ae60 !important; 
        }
        
        .btn-preview:hover {
            background-color: #219150 !important;
        }

        /* --- Gemini AI Feature Styles --- */
        
        /* 1. AI Explain Button (Sparkle Button) */
        .btn-ai-explain {
            background: linear-gradient(135deg, #8e44ad, #9b59b6) !important;
            color: white !important;
            border: none;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }
        
        .btn-ai-explain:hover {
            background: linear-gradient(135deg, #732d91, #8e44ad) !important;
            transform: scale(1.05);
        }

        /* 2. Floating AI Chat Button */
        .ai-fab {
            position: fixed;
            bottom: 33px; /* Adjusted slightly */
            right: 33px; /* Adjusted slightly */
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #2980b9, #6dd5fa);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 2000;
            transition: transform 0.3s ease;
        }

        .ai-fab:hover {
            transform: scale(1.1);
        }

        .ai-fab i {
            font-size: 28px;
            color: white;
        }

        /* 3. AI Chat Interface (Popup) */
        .ai-chat-window {
            display: none;
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 350px;
            height: 500px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            z-index: 2000;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }

        .ai-chat-header {
            background: linear-gradient(135deg, #2980b9, #6dd5fa);
            padding: 15px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
        }

        .ai-chat-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #f8f9fa;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ai-chat-footer {
            padding: 10px;
            border-top: 1px solid #eee;
            background-color: white;
            display: flex;
            gap: 10px;
        }

        .ai-chat-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }

        .ai-chat-send {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .message.user {
            background-color: #3498db;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .message.bot {
            background-color: #ecf0f1;
            color: #2c3e50;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            border: 1px solid #dcdcdc;
        }
        
        .typing-indicator {
            font-style: italic;
            color: #7f8c8d;
            font-size: 0.8rem;
            margin-left: 10px;
            display: none;
        }

        /* 4. AI Explanation Modal */
        .ai-explain-modal {
            display: none;
            position: fixed;
            z-index: 2001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
        }

        .ai-explain-content {
            background-color: white;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {transform: translateY(20px); opacity: 0;}
            to {transform: translateY(0); opacity: 1;}
        }

        .ai-explain-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .ai-explain-header h3 {
            margin: 0;
            color: #8e44ad;
        }

        .close-ai-modal {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #aaa;
        }
        
        .ai-result-text {
            line-height: 1.6;
            color: #333;
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <div class="header">
        <h1>Engineering Technology (ET)</h1>
        <p>Comprehensive resources for Engineering Technology studies</p>
    </div>

    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">AYEDU</a>
            <ul class="nav-list">
                <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="et.html" class="active"><i class="fas fa-cogs"></i> Engineering Technology</a></li>
                <li><a href="sft.html"><i class="fas fa-code"></i> Science for Technology</a></li>
                <li><a href="ict.html"><i class="fas fa-computer"></i> Information and Communication Technology</a></li>
            </ul>
            <div class="nav-right">
                <div class="search-box">
                    <input type="text" placeholder="Search ET files..." id="searchInput">
                    <button class="btn" onclick="searchFiles()"><i class="fas fa-search"></i></button>
                </div>
                <a href="login.html" class="btn">Login</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    
    <!-- Video Tutorials Section -->
    <div class="card fade-in-up">
        <div class="card-header" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
            <i class="fas fa-video"></i> ඉංජිනේරු තාක්ෂණවේදය වීඩියෝ නිබන්ධන (Engineering Technology Video Tutorials)
        </div>
        <div class="card-body">
            <div class="video-button-grid">
                <!-- Video Button 1 -->
                <div class="video-button" data-video-id="64OIya24vfc" data-video-title="හැඳින්වීම (Introduction)">
                    <div class="video-thumbnail-container">
                        <div class="video-thumbnail"></div>
                    </div>
                    <div class="video-title">හැඳින්වීම (Introduction)</div>
                </div>
                <!-- Video Button 2 -->
                <div class="video-button" data-video-id="dQw4w9WgXcQ" data-video-title="යාන්ත්‍රික පද්ධති (Mechanical Systems)">
                    <div class="video-thumbnail-container">
                        <div class="video-thumbnail"></div>
                    </div>
                    <div class="video-title">යාන්ත්‍රික පද්ධති (Mechanical Systems)</div>
                </div>
                <!-- Video Button 3 -->
                <div class="video-button" data-video-id="dQw4w9WgXcQ" data-video-title="විද්‍යුත් පරිපථ (Electrical Circuits)">
                    <div class="video-thumbnail-container">
                        <div class="video-thumbnail"></div>
                    </div>
                    <div class="video-title">විද්‍යුත් පරිපථ (Electrical Circuits)</div>
                </div>
                <!-- Video Button 4 -->
                <div class="video-button" data-video-id="dQw4w9WgXcQ" data-video-title="ද්‍රව්‍ය විද්‍යාව (Materials Science)">
                    <div class="video-thumbnail-container">
                        <div class="video-thumbnail"></div>
                    </div>
                    <div class="video-title">ද්‍රව්‍ය විද්‍යාව (Materials Science)</div>
                </div>
                <!-- Video Button 5 -->
                <div class="video-button" data-video-id="dQw4w9WgXcQ" data-video-title="ඉංජිනේරු ඇඳීම (Engineering Drawing)">
                    <div class="video-thumbnail-container">
                        <div class="video-thumbnail"></div>
                    </div>
                    <div class="video-title">ඉංජිනේරු ඇඳීම (Engineering Drawing)</div>
                </div>
                <!-- Video Button 6 -->
                <div class="video-button" data-video-id="dQw4w9WgXcQ" data-video-title="නිෂ්පාදන ක්‍රියාවලි (Manufacturing Processes)">
                    <div class="video-thumbnail-container">
                        <div class="video-thumbnail"></div>
                    </div>
                    <div class="video-title">නිෂ්පාදන ක්‍රියාවලි (Manufacturing Processes)</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Subject Overview -->
    <div class="container">
        <!-- Subject Overview -->
        <div class="card fade-in-up">
            <div class="card-header" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                <i class="fas fa-cogs"></i> Engineering Technology Overview
            </div>
            <div class="card-body">
                <p class="card-text">
                    Engineering Technology combines theoretical knowledge with practical application in various engineering fields. 
                    This section contains study materials covering mechanical systems, electrical circuits, materials science, 
                    engineering drawing, and manufacturing processes essential for A/L Technology students.
                </p>
            </div>
        </div>

        <!-- Filter and Sort Options -->
        <div class="card">
            <div class="card-body">
                <div class="filter-controls">
                    <div class="filter-group">
                        <label for="categoryFilter">Category:</label>
                        <select id="categoryFilter" class="form-control" onchange="filterFiles()">
                            <option value="all">All Categories</option>
                            <option value="mechanical">Mechanical Systems</option>
                            <option value="electrical">Electrical Circuits</option>
                            <option value="materials">Materials Science</option>
                            <option value="drawing">Engineering Drawing</option>
                            <option value="manufacturing">Manufacturing</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="typeFilter">File Type:</label>
                        <select id="typeFilter" class="form-control" onchange="filterFiles()">
                            <option value="all">All Types</option>
                            <option value="pdf">PDF Documents</option>
                            <option value="ppt">Presentations</option>
                            <option value="doc">Word Documents</option>
                            <option value="video">Video Tutorials</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="sortBy">Sort By:</label>
                        <select id="sortBy" class="form-control" onchange="sortFiles()">
                            <option value="name">Name</option>
                            <option value="date">Date Added</option>
                            <option value="size">File Size</option>
                            <option value="downloads">Downloads</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- File Categories -->
        <div class="row">
            <!-- Mechanical Systems -->
            <div class="col-md-6">
                <div class="card category-card" data-category="mechanical">
                    <div class="card-header">
                        <i class="fas fa-gear"></i> Mechanical Systems
                    </div>
                    <div class="card-body">
                        <div class="file-list">
                            <div class="file-item" data-category="mechanical" data-type="pdf" data-date="2024-01-15">
                                <div class="file-icon" style="color: #e74c3c;">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                <div class="file-info">
                                    <div class="file-name">Mechanical Systems Fundamentals</div>
                                    <div class="file-meta">PDF • 3.2 MB • 245 downloads</div>
                                </div>
                                <div class="file-actions">
                                    <button class="file-download" onclick="downloadFile('mechanical-fundamentals.pdf')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="file-download btn-ai-explain" onclick="explainTopic('Mechanical Systems Fundamentals')" title="Explain with AI">
                                        <i class="fas fa-wand-magic-sparkles"></i> Explain
                                    </button>
                                </div>
                            </div>
                            
                            <div class="file-item" data-category="mechanical" data-type="ppt" data-date="2024-01-10">
                                <div class="file-icon" style="color: #e74c3c;">
                                    <i class="fas fa-file-powerpoint"></i>
                                </div>
                                <div class="file-info">
                                    <div class="file-name">Gear Systems and Mechanisms</div>
                                    <div class="file-meta">PPT • 8.7 MB • 189 downloads</div>
                                </div>
                                <div class="file-actions">
                                    <button class="file-download" onclick="downloadFile('gear-systems.ppt')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="file-download btn-ai-explain" onclick="explainTopic('Gear Systems and Mechanisms')" title="Explain with AI">
                                        <i class="fas fa-wand-magic-sparkles"></i> Explain
                                    </button>
                                </div>
                            </div>
                            
                            <div class="file-item" data-category="mechanical" data-type="video" data-date="2024-01-08">
                                <div class="file-icon" style="color: #e74c3c;">
                                    <i class="fas fa-file-video"></i>
                                </div>
                                <div class="file-info">
                                    <div class="file-name">Hydraulic Systems Tutorial</div>
                                    <div class="file-meta">MP4 • 125.3 MB • 156 downloads</div>
                                </div>
                                <div class="file-actions">
                                    <button class="file-download" onclick="downloadFile('hydraulic-tutorial.mp4')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="file-download btn-ai-explain" onclick="explainTopic('Hydraulic Systems')" title="Explain with AI">
                                        <i class="fas fa-wand-magic-sparkles"></i> Explain
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Electrical Circuits -->
            <div class="col-md-6">
                <div class="card category-card" data-category="electrical">
                    <div class="card-header">
                        <i class="fas fa-bolt"></i> Electrical Circuits
                    </div>
                    <div class="card-body">
                        <div class="file-list">
                            <div class="file-item" data-category="electrical" data-type="pdf" data-date="2024-01-12">
                                <div class="file-icon" style="color: #f39c12;">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                <div class="file-info">
                                    <div class="file-name">Circuit Analysis Methods</div>
                                    <div class="file-meta">PDF • 4.1 MB • 298 downloads</div>
                                </div>
                                <div class="file-actions">
                                    <button class="file-download" onclick="downloadFile('circuit-analysis.pdf')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="file-download btn-ai-explain" onclick="explainTopic('Circuit Analysis Methods')" title="Explain with AI">
                                        <i class="fas fa-wand-magic-sparkles"></i> Explain
                                    </button>
                                </div>
                            </div>
                            
                            <div class="file-item" data-category="electrical" data-type="doc" data-date="2024-01-09">
                                <div class="file-icon" style="color: #f39c12;">
                                    <i class="fas fa-file-word"></i>
                                </div>
                                <div class="file-info">
                                    <div class="file-name">AC/DC Circuit Problems</div>
                                    <div class="file-meta">DOC • 2.8 MB • 167 downloads</div>
                                </div>
                                <div class="file-actions">
                                    <button class="file-download" onclick="downloadFile('ac-dc-problems.doc')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="file-download btn-ai-explain" onclick="explainTopic('AC/DC Circuit Problems')" title="Explain with AI">
                                        <i class="fas fa-wand-magic-sparkles"></i> Explain
                                    </button>
                                </div>
                            </div>
                            
                            <div class="file-item" data-category="electrical" data-type="pdf" data-date="2024-01-05">
                                <div class="file-icon" style="color: #f39c12;">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                <div class="file-info">
                                    <div class="file-name">Electronic Components Guide</div>
                                    <div class="file-meta">PDF • 6.5 MB • 234 downloads</div>
                                </div>
                                <div class="file-actions">
                                    <button class="file-download" onclick="downloadFile('components-guide.pdf')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="file-download btn-ai-explain" onclick="explainTopic('Electronic Components')" title="Explain with AI">
                                        <i class="fas fa-wand-magic-sparkles"></i> Explain
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Materials Science -->
            <div class="col-md-6">
                <div class="card category-card" data-category="materials">
                    <div class="card-header">
                        <i class="fas fa-atom"></i> Materials Science
                    </div>
                    <div class="card-body">
                        <div class="file-list">
                            <div class="file-item" data-category="materials" data-type="pdf" data-date="2024-01-14">
                                <div class="file-icon" style="color: #9b59b6;">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                <div class="file-info">
                                    <div class="file-name">Material Properties and Testing</div>
                                    <div class="file-meta">PDF • 5.3 MB • 178 downloads</div>
                                </div>
                                <div class="file-actions">
                                    <button class="file-download" onclick="downloadFile('material-properties.pdf')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="file-download btn-ai-explain" onclick="explainTopic('Material Properties and Testing')" title="Explain with AI">
                                        <i class="fas fa-wand-magic-sparkles"></i> Explain
                                    </button>
                                </div>
                            </div>
                            
                            <div class="file-item" data-category="materials" data-type="ppt" data-date="2024-01-11">
                                <div class="file-icon" style="color: #9b59b6;">
                                    <i class="fas fa-file-powerpoint"></i>
                                </div>
                                <div class="file-info">
                                    <div class="file-name">Metals and Alloys</div>
                                    <div class="file-meta">PPT • 12.1 MB • 145 downloads</div>
                                </div>
                                <div class="file-actions">
                                    <button class="file-download" onclick="downloadFile('metals-alloys.ppt')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="file-download btn-ai-explain" onclick="explainTopic('Metals and Alloys')" title="Explain with AI">
                                        <i class="fas fa-wand-magic-sparkles"></i> Explain
                                    </button>
                                </div>
                            </div>
                            
                            <div class="file-item" data-category="materials" data-type="pdf" data-date="2024-01-07">
                                <div class="file-icon" style="color: #9b59b6;">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                <div class="file-info">
                                    <div class="file-name">Composite Materials Handbook</div>
                                    <div class="file-meta">PDF • 8.9 MB • 123 downloads</div>
                                </div>
                                <div class="file-actions">
                                    <button class="file-download" onclick="downloadFile('composite-materials.pdf')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="file-download btn-ai-explain" onclick="explainTopic('Composite Materials')" title="Explain with AI">
                                        <i class="fas fa-wand-magic-sparkles"></i> Explain
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Engineering Drawing -->
            <div class="col-md-6">
                <div class="card category-card" data-category="drawing">
                    <div class="card-header">
                        <i class="fas fa-drafting-compass"></i> Engineering Drawing
                    </div>
                    <div class="card-body">
                        <div class="file-list">
                            <div class="file-item" data-category="drawing" data-type="pdf" data-date="2024-01-13">
                                <div class="file-icon" style="color: #2ecc71;">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                <div class="file-info">
                                    <div class="file-name">Technical Drawing Standards</div>
                                    <div class="file-meta">PDF • 7.2 MB • 267 downloads</div>
                                </div>
                                <div class="file-actions">
                                    <button class="file-download" onclick="downloadFile('drawing-standards.pdf')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="file-download btn-ai-explain" onclick="explainTopic('Technical Drawing Standards')" title="Explain with AI">
                                        <i class="fas fa-wand-magic-sparkles"></i> Explain
                                    </button>
                                </div>
                            </div>
                            
                            <div class="file-item" data-category="drawing" data-type="video" data-date="2024-01-06">
                                <div class="file-icon" style="color: #2ecc71;">
                                    <i class="fas fa-file-video"></i>
                                </div>
                                <div class="file-info">
                                    <div class="file-name">CAD Software Tutorial</div>
                                    <div class="file-meta">MP4 • 89.4 MB • 198 downloads</div>
                                </div>
                                <div class="file-actions">
                                    <button class="file-download" onclick="downloadFile('cad-tutorial.mp4')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="file-download btn-ai-explain" onclick="explainTopic('CAD Software')" title="Explain with AI">
                                        <i class="fas fa-wand-magic-sparkles"></i> Explain
                                    </button>
                                </div>
                            </div>
                            
                            <div class="file-item" data-category="drawing" data-type="pdf" data-date="2024-01-04">
                                <div class="file-icon" style="color: #2ecc71;">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                <div class="file-info">
                                    <div class="file-name">Orthographic Projection Guide</div>
                                    <div class="file-meta">PDF • 4.7 MB • 156 downloads</div>
                                </div>
                                <div class="file-actions">
                                    <button class="file-download" onclick="downloadFile('orthographic-guide.pdf')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="file-download btn-ai-explain" onclick="explainTopic('Orthographic Projection')" title="Explain with AI">
                                        <i class="fas fa-wand-magic-sparkles"></i> Explain
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Past Papers Section -->
        <div class="card">
            <div class="card-header">
                <i class="fas fa-file-alt"></i> Past Papers & Examinations
            </div>
            <div class="card-body">
                <div class="file-list">
                    <div class="file-item" data-category="exam" data-type="pdf" data-date="2022-01-01">
                        <div class="file-icon" style="color: #e74c3c;">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="file-info">
                            <div class="file-name">2022 Et.pdf</div>
                            <div class="file-meta">PDF • A/L Engineering Technology Past Paper</div>
                        </div>
                        <div class="file-actions">
                            <button class="file-download" onclick="window.open('https://drive.google.com/file/d/1VtZz1GT4FBCUXr7ro_nMtsBtl-AjxQOu/view?usp=drive_link', '_blank')" title="Download">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="file-download btn-preview" onclick="openPdfPreview('https://drive.google.com/file/d/1VtZz1GT4FBCUXr7ro_nMtsBtl-AjxQOu/view?usp=drive_link', '2022 Et.pdf')" title="Preview">
                                <i class="fas fa-eye"></i>
                            </button>
                             <button class="file-download btn-ai-explain" onclick="explainTopic('A/L Engineering Technology 2022 Paper Structure')" title="Analyze with AI">
                                <i class="fas fa-wand-magic-sparkles"></i> Explain
                            </button>
                        </div>
                    </div>
                    
                    <div class="file-item" data-category="exam" data-type="pdf" data-date="2021-01-01">
                        <div class="file-icon" style="color: #e74c3c;">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="file-info">
                            <div class="file-name">2021 Et.pdf</div>
                            <div class="file-meta">PDF • A/L Engineering Technology Past Paper</div>
                        </div>
                        <div class="file-actions">
                            <button class="file-download" onclick="window.open('https://drive.google.com/file/d/1RgzP_2uXQTSxnkd8q9SDEtV1CD9KxNM_/view?usp=drive_link', '_blank')" title="Download">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="file-download btn-preview" onclick="openPdfPreview('https://drive.google.com/file/d/1RgzP_2uXQTSxnkd8q9SDEtV1CD9KxNM_/view?usp=drive_link', '2021 Et.pdf')" title="Preview">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="file-download btn-ai-explain" onclick="explainTopic('A/L Engineering Technology 2021 Paper Structure')" title="Analyze with AI">
                                <i class="fas fa-wand-magic-sparkles"></i> Explain
                            </button>
                        </div>
                    </div>
                    
                    <div class="file-item" data-category="exam" data-type="pdf" data-date="2020-01-01">
                        <div class="file-icon" style="color: #e74c3c;">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="file-info">
                            <div class="file-name">2020 Et.pdf</div>
                            <div class="file-meta">PDF • A/L Engineering Technology Past Paper</div>
                        </div>
                        <div class="file-actions">
                            <button class="file-download" onclick="window.open('https://drive.google.com/file/d/1jtz5F7cnXaDLWMw_UlQDnVDhkAclgibn/view?usp=drive_link', '_blank')" title="Download">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="file-download btn-preview" onclick="openPdfPreview('https://drive.google.com/file/d/1jtz5F7cnXaDLWMw_UlQDnVDhkAclgibn/view?usp=drive_link', '2020 Et.pdf')" title="Preview">
                                <i class="fas fa-eye"></i>
                            </button>
                             <button class="file-download btn-ai-explain" onclick="explainTopic('A/L Engineering Technology 2020 Paper Structure')" title="Analyze with AI">
                                <i class="fas fa-wand-magic-sparkles"></i> Explain
                            </button>
                        </div>
                    </div>
                    
                    <div class="file-item" data-category="exam" data-type="pdf" data-date="2019-01-01">
                        <div class="file-icon" style="color: #e74c3c;">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="file-info">
                            <div class="file-name">2019 Et.pdf</div>
                            <div class="file-meta">PDF • A/L Engineering Technology Past Paper</div>
                        </div>
                        <div class="file-actions">
                            <button class="file-download" onclick="window.open('https://drive.google.com/file/d/1HvtBoeLIq6ctep1p0BEW73M8yZb1H5lU/view?usp=drive_link', '_blank')" title="Download">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="file-download btn-preview" onclick="openPdfPreview('https://drive.google.com/file/d/1HvtBoeLIq6ctep1p0BEW73M8yZb1H5lU/view?usp=drive_link', '2019 Et.pdf')" title="Preview">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="file-download btn-ai-explain" onclick="explainTopic('A/L Engineering Technology 2019 Paper Structure')" title="Analyze with AI">
                                <i class="fas fa-wand-magic-sparkles"></i> Explain
                            </button>
                        </div>
                    </div>
                    
                    <div class="file-item" data-category="exam" data-type="pdf" data-date="2018-01-01">
                        <div class="file-icon" style="color: #e74c3c;">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="file-info">
                            <div class="file-name">2018 Et.pdf</div>
                            <div class="file-meta">PDF • A/L Engineering Technology Past Paper</div>
                        </div>
                        <div class="file-actions">
                            <button class="file-download" onclick="window.open('https://drive.google.com/file/d/19aYdTkda8wJ1EXSRe1aW0pKS_AlGzGmn/view?usp=drive_link', '_blank')" title="Download">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="file-download btn-preview" onclick="openPdfPreview('https://drive.google.com/file/d/19aYdTkda8wJ1EXSRe1aW0pKS_AlGzGmn/view?usp=drive_link', '2018 Et.pdf')" title="Preview">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="file-download btn-ai-explain" onclick="explainTopic('A/L Engineering Technology 2018 Paper Structure')" title="Analyze with AI">
                                <i class="fas fa-wand-magic-sparkles"></i> Explain
                            </button>
                        </div>
                    </div>
                    
                    <div class="file-item" data-category="exam" data-type="pdf" data-date="2017-01-01">
                        <div class="file-icon" style="color: #e74c3c;">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="file-info">
                            <div class="file-name">2017 Et.pdf</div>
                            <div class="file-meta">PDF • A/L Engineering Technology Past Paper</div>
                        </div>
                        <div class="file-actions">
                            <button class="file-download" onclick="window.open('https://drive.google.com/file/d/1hdimBpIZq8VZGAyMkvWCLANoFfA_j52Q/view?usp=drive_link', '_blank')" title="Download">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="file-download btn-preview" onclick="openPdfPreview('https://drive.google.com/file/d/1hdimBpIZq8VZGAyMkvWCLANoFfA_j52Q/view?usp=drive_link', '2017 Et.pdf')" title="Preview">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="file-download btn-ai-explain" onclick="explainTopic('A/L Engineering Technology 2017 Paper Structure')" title="Analyze with AI">
                                <i class="fas fa-wand-magic-sparkles"></i> Explain
                            </button>
                        </div>
                    </div>
                    
                    <div class="file-item" data-category="exam" data-type="pdf" data-date="2016-01-01">
                        <div class="file-icon" style="color: #e74c3c;">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="file-info">
                            <div class="file-name">2016 Et.pdf</div>
                            <div class="file-meta">PDF • A/L Engineering Technology Past Paper</div>
                        </div>
                        <div class="file-actions">
                            <button class="file-download" onclick="window.open('https://drive.google.com/file/d/1J8822yRmbLZv_tdSiI54pKjkcgPikNJ-/view?usp=drive_link', '_blank')" title="Download">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="file-download btn-preview" onclick="openPdfPreview('https://drive.google.com/file/d/1J8822yRmbLZv_tdSiI54pKjkcgPikNJ-/view?usp=drive_link', '2016 Et.pdf')" title="Preview">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="file-download btn-ai-explain" onclick="explainTopic('A/L Engineering Technology 2016 Paper Structure')" title="Analyze with AI">
                                <i class="fas fa-wand-magic-sparkles"></i> Explain
                            </button>
                        </div>
                    </div>
                    
                    <div class="file-item" data-category="exam" data-type="pdf" data-date="2015-01-01">
                        <div class="file-icon" style="color: #e74c3c;">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="file-info">
                            <div class="file-name">2015 Et.pdf</div>
                            <div class="file-meta">PDF • A/L Engineering Technology Past Paper</div>
                        </div>
                        <div class="file-actions">
                            <button class="file-download" onclick="window.open('https://drive.google.com/file/d/1Ff5mjT7omwdMa7naknG8ODNuVUG9rbyo/view?usp=drive_link', '_blank')" title="Download">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="file-download btn-preview" onclick="openPdfPreview('https://drive.google.com/file/d/1Ff5mjT7omwdMa7naknG8ODNuVUG9rbyo/view?usp=drive_link', '2015 Et.pdf')" title="Preview">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="file-download btn-ai-explain" onclick="explainTopic('A/L Engineering Technology 2015 Paper Structure')" title="Analyze with AI">
                                <i class="fas fa-wand-magic-sparkles"></i> Explain
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2024 AYEDU - Educational File Sharing Platform</p>
        <p>Engineering Technology Resources for A/L Students</p>
        <div class="footer-links">
            <a href="index.html">Home</a>
            <a href="sft.html">Software Technology</a>
            <a href="ict.html">ICT</a>
            <a href="login.html">Login</a>
        </div>
    </footer>

    <!-- New PDF Preview Modal -->
    <div id="pdfModal" class="pdf-modal">
        <div class="pdf-modal-content">
            <div class="pdf-modal-header">
                <h3 id="pdfModalTitle" class="pdf-modal-title">PDF Preview</h3>
                <span class="pdf-modal-close" onclick="closePdfModal()">&times;</span>
            </div>
            <div class="pdf-iframe-container">
                <iframe id="pdfPreviewFrame" width="100%" height="100%" src="" frameborder="0"></iframe>
            </div>
        </div>
    </div>

    <!-- AI Explanation Modal -->
    <div id="aiExplainModal" class="ai-explain-modal">
        <div class="ai-explain-content">
            <span class="close-ai-modal" onclick="closeAiModal()">&times;</span>
            <div class="ai-explain-header">
                <i class="fas fa-robot fa-2x" style="color: #8e44ad;"></i>
                <h3 id="aiTopicTitle">AI Explanation</h3>
            </div>
            <div id="aiExplainBody" class="ai-result-text">
                Loading explanation...
            </div>
        </div>
    </div>

    <!-- Existing Video Modal -->
    <div id="videoModal" class="video-modal">
        <div class="video-modal-content">
            <div class="video-modal-header">
                <h3 id="modalTitle" class="video-modal-title">Video Title Placeholder</h3>
                <span class="video-modal-close" onclick="closeVideoModal()">&times;</span>
            </div>
            <div class="video-iframe-container">
                <iframe id="videoIframe" width="100%" height="100%" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <!-- Floating AI Chat Button -->
    <div class="ai-fab" onclick="toggleChat()">
        <i class="fas fa-comment-dots"></i>
    </div>

    <!-- AI Chat Window -->
    <div class="ai-chat-window" id="aiChatWindow">
        <div class="ai-chat-header">
            <span>✨ AI Tutor (AI ගුරුතුමා)</span>
            <span style="cursor: pointer;" onclick="toggleChat()">&times;</span>
        </div>
        <div class="ai-chat-body" id="chatBody">
            <div class="message bot">
                Hello! I am your AI Engineering Technology Tutor. How can I help you with your studies today? <br><br>
                ආයුබෝවන්! මම ඔබගේ ඉංජිනේරු තාක්ෂණවේදය AI ගුරුතුමා. අද පාඩම් වැඩ වලට මට කොහොමද උදව් කරන්න පුළුවන්?
            </div>
        </div>
        <div class="typing-indicator" id="typingIndicator">AI is typing...</div>
        <div class="ai-chat-footer">
            <input type="text" class="ai-chat-input" id="chatInput" placeholder="Ask a question..." onkeypress="handleEnter(event)">
            <button class="ai-chat-send" onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <script>
        // --- Gemini API Configuration ---
        // ⭐⭐ ඔයාගේ API යතුර මෙතැනට ඇතුළත් කරන්න ⭐⭐
        const apiKey = "AIzaSyBrzOrHx3VIg5nfbbk7a4kTiUDiIiW08I0"; 
        
        // --- AI Chat Functionality ---
        function toggleChat() {
            const chatWindow = document.getElementById('aiChatWindow');
            if (chatWindow.style.display === 'flex') {
                chatWindow.style.display = 'none';
            } else {
                chatWindow.style.display = 'flex';
                // Focus input when opened
                setTimeout(() => document.getElementById('chatInput').focus(), 100);
            }
        }

        function handleEnter(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        }

        async function sendMessage() {
            const inputField = document.getElementById('chatInput');
            const message = inputField.value.trim();
            if (!message) return;

            // Add user message
            addMessage(message, 'user');
            inputField.value = '';

            // Show typing indicator
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.style.display = 'block';
            
            // Scroll to bottom
            const chatBody = document.getElementById('chatBody');
            chatBody.scrollTop = chatBody.scrollHeight;

            // API key එක දාලා නැත්නම් මෙහෙම පණිවිඩයක් දෙන්න
            if (apiKey === "YOUR_GEMINI_API_KEY_HERE" || apiKey.trim() === "") {
                typingIndicator.style.display = 'none';
                addMessage("ඔබ API යතුර ඇතුළත් කර නොමැත. කරුණාකර 'apiKey' විචල්‍යයට ඔබේ Gemini API යතුර ඇතුළත් කරන්න. (API Key is missing. Please insert your key into the 'apiKey' variable.)", 'bot');
                return;
            }

            try {
                // Call Gemini API
                const response = await callGeminiAPI(message);
                typingIndicator.style.display = 'none';
                addMessage(response, 'bot');
            } catch (error) {
                console.error("Error calling Gemini:", error);
                typingIndicator.style.display = 'none';
                addMessage("සමාවෙන්න, මට දැන් මේකට උත්තර දෙන්න බැරි වුණා. පසුව නැවත උත්සාහ කරන්න. (Sorry, I failed to respond right now. Please try again later.)", 'bot');
            }
        }

        function addMessage(text, sender) {
            const chatBody = document.getElementById('chatBody');
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);
            // Simple markdown parsing for bold
            messageDiv.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        async function callGeminiAPI(prompt, context = "general") {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            let systemPrompt = "";
            if (context === "general") {
                systemPrompt = "You are a helpful Engineering Technology (ET) tutor for A/L students in Sri Lanka. Answer questions about Mechanical Systems, Electrical Circuits, Materials Science, and Engineering Drawing. Give answers that are easy to understand. You can answer in English or Sinhala depending on the user's language.";
            } else if (context === "explain") {
                systemPrompt = "You are an expert teacher. Explain the following Engineering Technology topic in simple terms for a student. Focus on key concepts. Keep it concise (under 150 words).";
            }

            const payload = {
                contents: [{
                    parts: [{ text: prompt }]
                }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                }
            };

            const maxRetries = 5;
            let delay = 1000; // 1 second

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 429) { // Too Many Requests
                        if (i < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2; // Exponential backoff
                            continue; // Retry
                        } else {
                            throw new Error("API rate limit exceeded after all retries.");
                        }
                    }

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`API call failed: ${response.statusText} - ${errorData.error?.message || 'Unknown error'}`);
                    }

                    const data = await response.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    return text || "No response generated.";

                } catch (error) {
                    if (i < maxRetries - 1 && error.message.includes("Failed to fetch")) {
                         // Basic network error handling, wait and retry
                         await new Promise(resolve => setTimeout(resolve, delay));
                         delay *= 2; 
                         continue;
                    }
                    throw error;
                }
            }
            throw new Error("Failed to get response from Gemini API after multiple retries.");
        }


        // --- AI Topic Explainer Functionality ---
        async function explainTopic(topicName) {
            const modal = document.getElementById('aiExplainModal');
            const titleEl = document.getElementById('aiTopicTitle');
            const bodyEl = document.getElementById('aiExplainBody');

            // Show modal with loading state
            titleEl.textContent = "Explaining: " + topicName;
            bodyEl.innerHTML = '<div style="text-align:center"><i class="fas fa-spinner fa-spin"></i> Analyzing content with AI...</div>';
            modal.style.display = 'flex';
            
            // API key check
            if (apiKey === "YOUR_GEMINI_API_KEY_HERE" || apiKey.trim() === "") {
                bodyEl.innerHTML = "<strong>⚠️ API යතුර නැත.</strong><br>කරුණාකර API යතුර 'apiKey' විචල්‍යයට ඇතුළත් කරන්න.";
                return;
            }

            try {
                const prompt = `Explain the topic "${topicName}" relevant to A/L Engineering Technology curriculum.`;
                const explanation = await callGeminiAPI(prompt, "explain");
                
                // Format the output lightly
                bodyEl.innerHTML = explanation.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            } catch (error) {
                bodyEl.textContent = "පැහැදිලි කිරීම ලබා ගැනීමට නොහැකි විය. කරුණාකර නැවත උත්සාහ කරන්න.";
            }
        }

        function closeAiModal() {
            document.getElementById('aiExplainModal').style.display = 'none';
        }

        // --- PDF Preview Functionality (Existing) ---
        function openPdfPreview(url, title) {
            let previewUrl = url;
            if (url.includes('drive.google.com')) {
                if (url.includes('/view')) {
                     previewUrl = url.replace('/view', '/preview');
                }
            }
            document.getElementById('pdfModalTitle').textContent = title;
            document.getElementById('pdfPreviewFrame').src = previewUrl;
            document.getElementById('pdfModal').style.display = 'block';
        }

        function closePdfModal() {
            document.getElementById('pdfModal').style.display = 'none';
            document.getElementById('pdfPreviewFrame').src = '';
        }

        // --- File Management Functions (Existing) ---
        function downloadFile(filename) {
            console.log(`Downloading: ${filename}. This is a simulation.`);
        }

        function searchFiles() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (searchTerm.trim() === '') {
                console.log('Please enter a search term');
                return;
            }
            const fileItems = document.querySelectorAll('.file-item');
            let found = false;
            fileItems.forEach(item => {
                const fileName = item.querySelector('.file-name').textContent.toLowerCase();
                if (fileName.includes(searchTerm)) {
                    item.style.display = 'flex';
                    item.style.backgroundColor = '#fff3cd';
                    found = true;
                } else {
                    item.style.display = 'none';
                }
            });
            if (!found) {
                console.log(`No files found matching: "${searchTerm}"`);
                showAllFiles();
            }
        }

        function filterFiles() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const typeFilter = document.getElementById('typeFilter').value;
            const fileItems = document.querySelectorAll('.file-item');
            fileItems.forEach(item => {
                const category = item.getAttribute('data-category');
                const type = item.getAttribute('data-type');
                const categoryMatch = categoryFilter === 'all' || category === categoryFilter;
                const typeMatch = typeFilter === 'all' || type === typeFilter;
                if (categoryMatch && typeMatch) {
                    item.style.display = 'flex';
                    item.style.backgroundColor = '';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function sortFiles() {
            const sortBy = document.getElementById('sortBy').value;
            const categories = document.querySelectorAll('.category-card');
            categories.forEach(category => {
                const fileList = category.querySelector('.file-list');
                const fileItems = Array.from(fileList.querySelectorAll('.file-item'));
                fileItems.sort((a, b) => {
                    switch(sortBy) {
                        case 'name': return a.querySelector('.file-name').textContent.localeCompare(b.querySelector('.file-name').textContent);
                        case 'date': return new Date(b.getAttribute('data-date')) - new Date(a.getAttribute('data-date'));
                        case 'size': 
                            const sizeA = parseFloat(a.querySelector('.file-meta').textContent.match(/[\d.]+/)[0]);
                            const sizeB = parseFloat(b.querySelector('.file-meta').textContent.match(/[\d.]+/)[0]);
                            return sizeB - sizeA;
                        case 'downloads':
                            const downloadsA = parseInt(a.querySelector('.file-meta').textContent.match(/(\d+) downloads/)[1]);
                            const downloadsB = parseInt(b.querySelector('.file-meta').textContent.match(/(\d+) downloads/)[1]);
                            return downloadsB - downloadsA;
                        default: return 0;
                    }
                });
                fileItems.forEach(item => fileList.appendChild(item));
            });
        }

        function showAllFiles() {
            const fileItems = document.querySelectorAll('.file-item');
            fileItems.forEach(item => {
                item.style.display = 'flex';
                item.style.backgroundColor = '';
            });
        }

        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchFiles();
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.card');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('fade-in-up');
                }, index * 100);
            });
        });

        // Close Modals on click outside
        window.onclick = function(event) {
            const pdfModal = document.getElementById('pdfModal');
            const videoModal = document.getElementById('videoModal');
            const aiExplainModal = document.getElementById('aiExplainModal');
            
            if (event.target == pdfModal) closePdfModal();
            if (event.target == videoModal && typeof closeVideoModal === 'function') closeVideoModal();
            if (event.target == aiExplainModal) closeAiModal();
        }
    </script>
</body>
</html>
